(()=>{WEBSITE_URL="https://chessvanced.com/";window.location.href==WEBSITE_URL?async function(){await async function(){var e=document.createElement("div");e.id="injectedData",console.log("BB");var t=[s="analysisData"];const n=(await chrome.storage.local.get(t))[s];e.setAttribute("analysisData",JSON.stringify(n)),t=[s="moveArray"];const a=(await chrome.storage.local.get(t))[s];e.setAttribute("moveArray",JSON.stringify(a)),t=[s="fenArray"];const r=(await chrome.storage.local.get(t))[s];e.setAttribute("fenArray",JSON.stringify(r)),t=[s="analyzedFens"];const o=(await chrome.storage.local.get(t))[s];var s;e.setAttribute("analyzedFens",JSON.stringify(o)),t=[s="playerSide"];const i=(await chrome.storage.local.get(t))[s];e.setAttribute("playerSide",JSON.stringify(i)),(document.head||document.documentElement).appendChild(e)}();var e=document.createElement("script");e.src=chrome.runtime.getURL("contentScript.js"),(document.head||document.documentElement).appendChild(e)}():(console.log("start scrapin"),scraper=new class{getPlayerSide(){try{return document.getElementById("board-layout-player-top").getElementsByClassName("clock-component")[0].className.includes("white")?"black":"white"}catch(e){return console.log(e),"white"}}gameReviewButtonClickHandler(){this.sendCurrentGameState(),window.open(WEBSITE_URL,"_blank")}tryToCreateButton(){var e=document.getElementsByClassName("game-review-buttons-component")[0];if(e&&2==e.children.length){const t=this.createCoolButton();t.addEventListener("click",(()=>{this.gameReviewButtonClickHandler()})),e.appendChild(t)}}createCoolButton(){const e=document.createElement("button");e.classList.add("purple-button"),e.style="\n        grid-row: 2;\n        grid-column: 1/span2;\n        height: 50px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        background-color: purple;\n        color: white;\n        padding: 10px 20px;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        transition: background-color 0.3s ease;\n        ";const t=document.createElement("span");t.classList.add("star"),t.textContent="â˜…",t.style="font-size: 18px;",e.appendChild(t);const n=document.createElement("span");return n.classList.add("button-text"),n.textContent="Free Game Review",n.style="font-weight: bold;\n        margin-right: 5px;",e.appendChild(n),e}extractStringFromNode(e){var t="";for(const n of e.childNodes)n.nodeType===Node.TEXT_NODE?t+=n.textContent:n.nodeType===Node.ELEMENT_NODE&&"SPAN"===n.tagName&&(t+=n.getAttribute("data-figurine"));return t}HTMLmovesToSEN(e){var t=[];const n=e.getElementsByClassName("white node"),a=e.getElementsByClassName("black node");for(let e=0;e<Math.max(n.length,a.length);e++)e<n.length&&t.push(this.extractStringFromNode(n[e])),e<a.length&&t.push(this.extractStringFromNode(a[e]));return t}isLiveGame(){return 0==document.getElementsByClassName("new-game-buttons-component").length}returnArrayOfMoves(){const e=window.location.href,t=this.getPlayerSide();console.log("i am player color ",t);var n=document.querySelectorAll("vertical-move-list")[0];return n?{moveArray:this.HTMLmovesToSEN(n),gameId:e,playerSide:t}:{moveArray:null,gameId:null,playerSide:t}}sendCurrentGameState(){const{moveArray:e,gameId:t,playerSide:n}=this.returnArrayOfMoves();e&&chrome.runtime.sendMessage({type:"analyzeMoves",message:{moves:e,gameId:t,playerSide:n}})}async startScraping(){for(;;)if(await new Promise((e=>setTimeout(e,2e3))),this.tryToCreateButton(),this.isLiveGame())try{this.sendCurrentGameState()}catch(e){console.log("some error",e)}}},scraper.startScraping())})();