(()=>{const e="https://chessvanced.com/analysis/";console.log(window.location.href,e);const t=window.location.href;t==e?async function(){await async function(){var e=document.createElement("div");e.id="injectedData",console.log("BB");var t=[s="analysisData"];const n=(await chrome.storage.local.get(t))[s];e.setAttribute("analysisData",JSON.stringify(n)),t=[s="moveArray"];const o=(await chrome.storage.local.get(t))[s];e.setAttribute("moveArray",JSON.stringify(o)),t=[s="fenArray"];const a=(await chrome.storage.local.get(t))[s];e.setAttribute("fenArray",JSON.stringify(a)),t=[s="analyzedFens"];const r=(await chrome.storage.local.get(t))[s];var s;e.setAttribute("analyzedFens",JSON.stringify(r)),t=[s="playerSide"];const i=(await chrome.storage.local.get(t))[s];e.setAttribute("playerSide",JSON.stringify(i)),(document.head||document.documentElement).appendChild(e)}();var e=document.createElement("script");e.src=chrome.runtime.getURL("contentScript.js"),(document.head||document.documentElement).appendChild(e)}():t.includes("chess.com")&&(console.log("start scrapin"),scraper=new class{getPlayerSide(){try{return document.getElementById("board-layout-player-top").getElementsByClassName("clock-component")[0].className.includes("white")?"black":"white"}catch(e){return console.log(e),"white"}}gameReviewButtonClickHandler(){this.sendCurrentGameState(),window.open(e,"_blank")}tryToCreateButton(){if(console.log("creatin some buttton"),window.location.href.includes("https://www.chess.com/game")){var e=document.getElementsByClassName("game-review-buttons-component")[0];if(e&&2==e.children.length){const t=this.createCoolButton("chessvanced-fixed");t.addEventListener("click",(()=>{this.gameReviewButtonClickHandler()})),e.appendChild(t)}if(!document.getElementById("chessvanced-floating")){const e=this.createCoolButton("chessvanced-floating");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="9999",e.addEventListener("click",(()=>{this.gameReviewButtonClickHandler()})),document.body.appendChild(e)}}}createCoolButton(e){const t=document.createElement("button");t.classList.add("purple-button"),t.id=e,t.style="\n        grid-row: 2;\n        grid-column: 1/span2;\n        height: 50px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        background-color: purple;\n        color: white;\n        padding: 10px 20px;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        transition: background-color 0.3s ease;\n        ";const n=document.createElement("span");n.classList.add("star"),n.textContent="â˜…",n.style="font-size: 18px;",t.appendChild(n);const o=document.createElement("span");return o.classList.add("button-text"),o.textContent="Free Game Review",o.style="font-weight: bold;\n        margin-right: 5px;",t.appendChild(o),t}extractStringFromNode(e){var t="";for(const n of e.childNodes)n.nodeType===Node.TEXT_NODE?t+=n.textContent:n.nodeType===Node.ELEMENT_NODE&&"SPAN"===n.tagName&&(t+=n.getAttribute("data-figurine"));return t}HTMLmovesToSEN(e){var t=[];const n=e.getElementsByClassName("white node"),o=e.getElementsByClassName("black node");for(let e=0;e<Math.max(n.length,o.length);e++)e<n.length&&t.push(this.extractStringFromNode(n[e])),e<o.length&&t.push(this.extractStringFromNode(o[e]));return t}isLiveGame(){return 0==document.getElementsByClassName("new-game-buttons-component").length}returnArrayOfMoves(){const e=window.location.href,t=this.getPlayerSide();console.log("i am player color ",t);var n=document.querySelectorAll("vertical-move-list")[0];return n?{moveArray:this.HTMLmovesToSEN(n),gameId:e,playerSide:t}:{moveArray:null,gameId:null,playerSide:t}}sendCurrentGameState(){const{moveArray:e,gameId:t,playerSide:n}=this.returnArrayOfMoves();e&&chrome.runtime.sendMessage({type:"analyzeMoves",message:{moves:e,gameId:t,playerSide:n}})}tryToDeleteButton(e){const t=document.getElementById(e);t&&t.parentNode.removeChild(t)}async startScraping(){for(;;)if(await new Promise((e=>setTimeout(e,2e3))),this.isLiveGame()){this.tryToDeleteButton("chessvanced-floating");try{this.sendCurrentGameState()}catch(e){console.log("some error",e)}}else this.tryToCreateButton()}},scraper.startScraping())})();