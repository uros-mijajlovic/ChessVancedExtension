(()=>{const e="https://chessvanced.com/analysis";class t{getPlayerSide(){try{var e="white";if(window.location.href.includes("chess.com"))e=document.getElementById("board-layout-player-top").getElementsByClassName("clock-component")[0].className.includes("white")?"black":"white";return e}catch(e){return"white"}}getPlayersElo(){try{var e,t=[];window.location.href.includes("chess.com")?e=document.getElementsByClassName("rating-score-rating"):window.location.href.includes("lichess")&&(e=document.getElementsByTagName("rating"));for(const n of e)t.push(parseInt(n.textContent));return t}catch(e){return[-1,-1]}}gameReviewButtonClickHandler(){this.sendCurrentGameState(),window.open(e,"_blank")}tryToCreateButton(){if(window.location.href.includes("https://www.chess.com/game")){if(!document.getElementById("chessvanced-floating")){const e=this.createCoolButton("chessvanced-floating");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="9999",e.addEventListener("click",(()=>{this.gameReviewButtonClickHandler()})),document.body.appendChild(e)}}else if(window.location.href.includes("lichess.org")){if(!document.getElementById("chessvanced-floating")){const e=this.createCoolButton("chessvanced-floating");e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.zIndex="9999",e.addEventListener("click",(()=>{this.gameReviewButtonClickHandler()})),document.body.appendChild(e)}}}isInGame(){if(window.location.href.includes("lichess.org"))return 0==document.querySelectorAll("cg-board").length}createCoolButton(e){const t=document.createElement("button");t.classList.add("purple-button"),t.id=e,t.style="\n        grid-row: 2;\n        grid-column: 1/span2;\n        height: 50px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        background-color: purple;\n        color: white;\n        padding: 10px 20px;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        transition: background-color 0.3s ease;\n        ";const n=document.createElement("span");n.classList.add("star"),n.textContent="â˜…",n.style="font-size: 18px;",t.appendChild(n);const s=document.createElement("span");return s.classList.add("button-text"),s.textContent="Free Game Review",s.style="font-weight: bold;\n        margin-right: 5px;",t.appendChild(s),t}extractStringFromNode(e){var t="";for(const n of e.childNodes)if(n.nodeType===Node.TEXT_NODE)t+=n.textContent;else if(n.nodeType===Node.ELEMENT_NODE&&"SPAN"===n.tagName){t+=n.getAttribute("data-figurine")}return t}HTMLmovesToSEN(e){var t=[];const n=e.getElementsByClassName("white node"),s=e.getElementsByClassName("black node");for(let e=0;e<Math.max(n.length,s.length);e++)e<n.length&&t.push(this.extractStringFromNode(n[e])),e<s.length&&t.push(this.extractStringFromNode(s[e]));return t}moveContainerToSENLichess(e){var t=[];const n=e.querySelectorAll("kwdb");for(const e of n)t.push(e.textContent);return t}isLiveGame(){if(window.location.href.includes("lichess.org"))return 1==document.getElementsByClassName("game__meta")[0].children.length;{const e=0==document.getElementsByClassName("new-game-buttons-component").length,t=0==document.getElementsByClassName("quick-analysis-results-tally").length,n=0==document.getElementsByClassName("game-review-buttons-component").length;return e&&t&&n}}returnArrayOfMoves(){const e=this.getPlayersElo(),t=window.location.href;var n,s=this.getPlayerSide();if(t.includes("chess.com")){if(n=document.getElementsByClassName("vertical-move-list")[0]){const o=this.HTMLmovesToSEN(n);return{moves:o,gameId:t,playerSide:s,playerElos:e}}return{moves:null,gameId:null,playerSide:s,playerElos:e}}if(t.includes("lichess.org")){if(n=document.querySelector("l4x")){return{moves:this.moveContainerToSENLichess(n),gameId:t,playerSide:s,playerElos:e}}return{moves:null,gameId:null,playerSide:s,playerElos:e}}}sendCurrentGameState(){const e=this.returnArrayOfMoves();e.moves&&chrome.runtime.sendMessage({type:"analyzeMoves",message:e})}tryToDeleteButton(e){const t=document.getElementById(e);t&&t.parentNode.removeChild(t)}async startScraping(){for(;;)if(await new Promise((e=>setTimeout(e,2e3))),this.isLiveGame()){this.tryToDeleteButton("chessvanced-floating");try{this.sendCurrentGameState()}catch(e){}}else this.tryToCreateButton()}}async function n(e){const t=[e];return(await chrome.storage.local.get(t))[e]}window.location.href;const s=window.location.href;s.includes(e)?async function(){await async function(){var e=document.createElement("div");e.id="injectedData";const t=await n("analysisData");e.setAttribute("analysisData",JSON.stringify(t));const s=await n("moveArray");e.setAttribute("moveArray",JSON.stringify(s));const o=await n("fenArray");e.setAttribute("fenArray",JSON.stringify(o));const a=await n("analyzedFens");e.setAttribute("analyzedFens",JSON.stringify(a));const r=await n("playerSide");e.setAttribute("playerSide",JSON.stringify(r));const i=await n("playerElos");e.setAttribute("playerElos",JSON.stringify(i)),(document.head||document.documentElement).appendChild(e)}();var e=document.createElement("script");e.src=chrome.runtime.getURL("contentScript.js"),(document.head||document.documentElement).appendChild(e)}():(s.includes("chess.com")||s.includes("lichess.org"))&&(scraper=new t,scraper.startScraping())})();